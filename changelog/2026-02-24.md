# Shopping agent: observability, reliability, and first Mac Mini run

Focused on fixing pain points from yesterday's runs. Replaced the
fragile clipboard URL workflow, added cost tracking per step, and ran
the agent on the Mac Mini for the first time over SSH.

## Improvements

- Replace clipboard URL workflow (super+l, super+c, pbpaste) with
  AppleScript one-liner: `osascript -e 'tell application "Safari" to
get URL of current tab of front window'`. Eliminates the
  Favorites/iCloud Tabs dropdown issue that burned ~15 iterations in
  yesterday's watch run.
- Per-step cost logging with step and cumulative totals. No more
  waiting for a full run to see spend.
- Graceful keyboard interrupt handling — Ctrl+C prints usage summary
  and closes bash cleanly.
- Iteration budget injected into conversation. Model sees
  `[Iteration 15/50 — $0.85 spent]` each step, with a wrap-up nudge
  at 80% budget.
- Prompt: write results incrementally as options are found, stop after
  3 good options, never recommend products from memory.
- Prompt caching enabled via top-level `cache_control`.
- Cost calculation now accounts for cache writes (1.25x) and reads
  (0.1x).
- Token summary shows total input with cache breakdown instead of
  just uncached tokens.
- CLI: added `--item`, `--task`, `--raw`, and `--dry-run` flags.

## Observations from today's runs

### Watch run (item #3, morning, laptop)

- 50 iterations, ~20 minutes, ~$3.04
- Safari Favorites dropdown triggered repeatedly on Amazon when using
  super+l — model got stuck in a loop for ~15 iterations
- Hit max iterations without writing results
- pbpaste returned the wrong URL (stale clipboard from earlier copy)
- No prompt caching (0 cache hits) — system prompt resent fresh on
  every call
- 18 of 20 minutes was API time

### Dark wash jeans run (item #1, evening, Mac Mini over SSH)

- 50 iterations, ~9 minutes, ~$3.83
- AppleScript URL helper worked perfectly — one bash call, no issues
- Iteration budget awareness kicked in — model shifted to wrap-up
  mode at iteration 41
- Caching working: 556K cache write, 126K cache read
- Model hallucinated 2 of 3 options from training data instead of
  browsing. Only one product was actually visited and verified on-site.
  Added prompt guardrail against this.
- Write-as-you-go partially worked: model created file early but
  couldn't figure out how to append, deleted and recreated at the end
- Slow page loads on Levi's and Madewell burned many iterations
  (skeleton loaders, 404s). Mini's local network speed was an
  unexpected bottleneck.
- API latency much better in evening — most calls 4-12s vs 60-250s
  spikes in the morning

## Infrastructure

- Mac Mini set up as remote agent host via SSH
- Opened issue #4: explore provider-agnostic tool schema to reduce
  Anthropic dependency
